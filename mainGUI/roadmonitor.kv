ScreenManager:
    MainMenu:
        name: "main"
    ConfigMenu:
        name: "config"

<CustomPopup>:
    auto_dismiss: False
    title: ""
    separator_height: 0
    size_hint: (0.5, 0.5)
    background_color: (0,0,0,0)

    BoxLayout:
        orientation: 'vertical' 

        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            RoundedRectangle:
                pos: self.pos
                size: self.size
                source: "assets/Popups/background.png"

        Label:
            text: root.message
            font_name: 'Orbitron'
            font_size: '24sp'
            halign: 'center'
            valign: 'middle'

        BoxLayout:
            orientation: 'horizontal'

            DebouncedButton:
                text: "Yes"
                font_name: 'Orbitron'
                font_size: '40sp'
                background_color: (0,0,0,0)
                color: (0,1,0.48235,1) if self.state == 'down' else (1,1,1,1)
                always_release: True
                on_perform_action: 
                    root.dismiss()
                    app.reboot_system()

            DebouncedButton:
                text: "No"
                font_name: 'Orbitron'
                font_size: '40sp'
                background_color: (0,0,0,0)
                color: (0,1,0.48235,1) if self.state == 'down' else (1,1,1,1)
                always_release: True
                on_perform_action: 
                    root.dismiss()

<MainMenu>:
    CustomLayout:
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size
                source: "assets/MainMenu/background.png"
        
        FloatLayout:
            size_hint: (0.7,0.51)

            canvas.before:
                Color:
                    rgba: 1, 1, 1, 0
                Rectangle:
                    pos: self.pos
                    size: self.size
            
            Label:
                pos_hint: {"center_x": 0.375, "center_y": 1.05}
                text: '(m/sÂ²)'
                font_name: 'Roboto'
                font_size: '15sp'
                canvas.before:
                    PushMatrix
                    Rotate:
                        angle: 90
                        origin: self.center
                canvas.after:
                    PopMatrix

            CustomGraph:
                id: rt_graph
                pos_hint: {"center_x": 0.855 ,"center_y": 0.6}
                ylabel: "Vertical Acceleration        "
                xlabel: "Time (seconds)"
                x_grid: False
                y_grid: False
                y_grid_label: True
                x_grid_label: True
                x_ticks_minor: 5
                x_ticks_major: 1
                y_ticks_minor: 2
                y_ticks_major: 5
                xmin: 0 
                xmax: 5
                ymin: -25
                ymax: 25
                label_options: {'font_name': 'Orbitron'}

        MenuButton:
            id: vehicle_config_button
            target: "config"
            source_normal: "assets/MainMenu/config_button_normal.png"
            source_down: "assets/MainMenu/config_button_pressed.png"
            size_hint: (0.29125, 0.2875)
            pos_hint: {"center_x": 0.8275, "center_y": 0.81}
            
            on_perform_action: 
                app.root.transition.direction = "left"
                app.root.current = self.target

        MenuButton:
            id: data_collection_button
            source_normal: "assets/MainMenu/ss_button_normal.png"
            source_down: "assets/MainMenu/ss_button_pressed.png"
            size_hint: (0.1725, 0.5583)
            pos_hint: {"center_x": 0.1130, "center_y": 0.325}
            
            on_perform_action: 
                root.toggle_data_collection()
        
        MenuButton:
            id: power_button
            target: "config"
            source_normal: "assets/MainMenu/power_button_normal.png"
            source_down: "assets/MainMenu/power_button_pressed.png"
            size_hint: (0.1725, 0.2875)
            pos_hint: {"center_x": 0.1130, "center_y": 0.81}
            
            on_perform_action: 
                app.show_popup()

        Label:
            id: label_e
            pos_hint: {"center_x": 0.62, "center_y": 0.49}
            text: 'DATA COLLECTION ' + app.data_collection_status
            font_name: 'Orbitron'
            opacity: 0 if app.data_collection_on else 1
            font_size: '24sp'

        Label:
            id: label_f
            pos_hint: {"center_x": 0.44, "center_y": 0.90}
            text: 'Road Condition'
            font_name: 'Orbitron'
            font_size: '24sp'

        Label:
            id: label_g
            pos_hint: {"center_x": 0.44, "center_y": 0.775}
            text:
                app.condition_text.get(app.condition_scale, "Unknown") if app.data_collection_on else "N/A"

            color_pallet: ([1,0.122,0.122,1], [1,0.443,0.122,1], [0.78,0.914,0,1], [0.604, 0.980, 0, 1], [0.196, 0.980, 0, 1])
            
            color:
                (self.color_pallet[app.condition_scale - 1] if app.data_collection_on and 1 <= app.condition_scale <= 5 else (1,1,1,1))
                
            font_name: 'Orbitron'
            font_size: '50sp'

<ConfigMenu>:
    CustomLayout:
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size
                source: "assets/ConfigMenu/background.png"

        BoxLayout:
            orientation: 'horizontal'
            size_hint: (0.73, 0.285)
            pos_hint: {"center_x": 0.605, "center_y": 0.81}

            MenuButton:
                id: dcrmnt_yr
                source_normal: "assets/ConfigMenu/decrease_button_normal.png"
                source_down: "assets/ConfigMenu/decrease_button_pressed.png"
                size_hint: (0.25, 1)

                on_perform_action: 
                    root.decrement_year_release()

            BoxLayout:
                orientation: 'vertical'
                size_hint: (0.5, 1)

                Label:
                    id: label_a
                    size_hint: (1, 0.5)
                    text: 'Vehicle Year'
                    font_name: 'Orbitron'
                    font_size: '24sp'

                Label:
                    id: label_b
                    text: app.vehicle_year
                    font_name: 'Orbitron'
                    font_size: '80sp'

            MenuButton:
                id: incrmnt_yr
                source_normal: "assets/ConfigMenu/increase_button_normal.png"
                source_down: "assets/ConfigMenu/increase_button_pressed.png"
                size_hint: (0.25, 1)

                on_perform_action: 
                    root.increment_year_release()

        BoxLayout:
            orientation: 'horizontal'
            size_hint: (0.93, 0.28)
            pos_hint: {"center_x": 0.5, "center_y": 0.47}

            FloatLayout:

                Label:
                    id: label_c
                    pos_hint: {"center_x": 0.5, "center_y": 0.80}
                    text: 'Vehicle Class'
                    font_name: 'Orbitron'
                    font_size: '24sp'

                DebouncedButton:
                    pos_hint: {"center_x": 0.5, "center_y": 0.30}
                    background_color: 0,0,0,0
                    id: change_class_debouncedbutton
                    text: app.vehicle_class
                    font_name: 'Orbitron'
                    font_size: '50sp'
                    color: (0,1,0.48235,1) if self.state == 'down' else (1,1,1,1)
                    always_release: True
                    on_perform_action: 
                        root.change_vehicle_class()

            FloatLayout:

                Label:
                    id: label_d
                    pos_hint: {"center_x": 0.5, "center_y": 0.80}
                    text: 'Vehicle Type'
                    font_name: 'Orbitron'
                    font_size: '24sp'

                DebouncedButton:
                    pos_hint: {"center_x": 0.5, "center_y": 0.30}
                    background_color: 0,0,0,0
                    id: change_type_button
                    text: app.vehicle_type
                    font_name: 'Orbitron'
                    font_size: '50sp'
                    color: (0,1,0.48235,1) if self.state == 'down' else (1,1,1,1)
                    always_release: True
                    on_perform_action: 
                        root.change_vehicle_type()
                    

        MenuButton:
            id: back_button
            target: "main"
            source_normal: "assets/ConfigMenu/back_button_normal.png"
            source_down: "assets/ConfigMenu/back_button_pressed.png"
            size_hint: (0.1725, 0.2875)
            pos_hint: {"center_x": 0.1130, "center_y": 0.81}

            on_perform_action: 
                app.root.transition.direction = "right"
                app.root.current = self.target

        MenuButton:
            id: connection_button
            source_normal: "assets/ConfigMenu/back_button_normal.png"
            source_down: "assets/ConfigMenu/back_button_pressed.png"
            size_hint: (0.1725, 0.2875)
            pos_hint: {"center_x": 0.5, "center_y": 0.17}

            on_perform_action: 
                app.root.transition.direction = "right"
                app.root.current = self.target